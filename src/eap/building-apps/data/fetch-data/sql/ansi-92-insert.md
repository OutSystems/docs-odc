---
guid: 22582d71-e681-4548-a658-ed3eabda5ed0
locale: en-us
summary: Learn to use INSERT and UPSERT statements in ANSI-92 queries to create or update records on external entities from OutSystems Developer Cloud (ODC).
figma: 
coverage-type:
  - apply
  - understand
topic:
app_type: mobile apps,reactive web apps
platform-version: odc
audience:
  - backend developers
  - full stack developers
  - tech leads
tags: sql statements,database operations,data insertion,record update
outsystems-tools:
  - odc studio
---

# INSERT and UPSERT statements in ANSI-92 queries

```sql
{ INSERT | UPSERT } INTO entity
( attribute [, attribute ]* )
source

source:
        VALUES ( expression [, expression ]* ) [, ( expression [, expression ]* ) ]*
    |   select
```

## Insert

`INSERT` creates one or more new records in an entity on an external system.

One or more target attribute names must be specified. The attributes may be specified in any order but each attribute must only appear once in the list. The target attributes may be qualified (`{entity}.[attribute]`) and this is recommended to avoid potential issues when attributes are renamed in ODC Portal.

Attributes which use unsupported data types or which are always generated by the external system cannot be inserted and shouldn't be included in the target attribute names. If optional attributes (can be `NULL` or have a default value) are included in the target attributes, then the provided values will be set on these attributes. If the attributes aren't included, then they will be set to `NULL`.

An `INSERT` may source records from a `VALUES` clause or `SELECT`.

When using a `VALUES` clause, it must include one or more tuples containing values to set for the target attributes. The number of expressions in each `VALUES` tuple must match the number of target attributes. The expressions will be assigned to the target attributes in the same order from left to right. One record will be created in the entity for each tuple provided. Insertion of multiple records isn't supported for all external systems, refer to [Supported operations](#supported-operations) for more information.

When using a `SELECT` instead of `VALUES`, the query must return records with attributes which match the number and types of the target attributes. This syntax is only [supported](#supported-operations) with some external systems and all entities referenced in the query must be from the same connection (reading from one external system and writing to another is not supported). The full [SELECT](ansi-92-select.md) syntax may be used including `WITH` and set operations such as `UNION`.

An `INSERT` statement that inserts a single record into an entity with one or more primary key attributes may return a result containing the inserted values of those attributes. The behaviour varies between external systems, refer to [Returned Primary Key Attributes](#returned-primary-key-attributes) for more information. This only applies when using `VALUES` or an equivalent `SELECT` which does not reference an entity.

An `INSERT` statement that inserts a single record into an entity which does not have primary key attributes won't return a result.

An `INSERT` statement that inserts multiple records into an entity will not return a result.

## Upsert

`UPSERT` creates or updates one or more records in an entity on an external system.

`UPSERT` is only supported for entities which have a non-generated primary key. The primary key attributes must be included in the target attributes along with all other non-nullable attributes on the entity. For each record produced by the `VALUES` clause or `SELECT`, if there is no matching record in the entity with the same primary key, then a record is created. Existing records with matching primary keys will be updated with the provided values.

The syntax and grammar for `UPSERT` is identical to `INSERT`. The rules for optional attributes and attributes of unsupported data types are also the same.

`UPSERT` never returns a result.

<div class="info" markdown="1">

* The user configured on the connection must have permission to write to the entity in the external system.
* If the entity has mandatory attributes (`NOT NULL`) of an unsupported data type then it won't be possible to insert records.
* If the entity only contains generated attributes then it won't be possible to insert records.

</div>

## Examples

```sql
-- Insert a single record (may return inserted primary key values)
INSERT INTO {entity} ({entity}.[attr1], {entity}.[attr2])
VALUES ('abc', @dynamic);

-- Equivalent syntax using SELECT (may return inserted primary key values)
INSERT INTO {entity} ({entity}.[attr1], {entity}.[attr2])
SELECT 'abc', @dynamic;

-- Insert multiple records
INSERT INTO {entity} ({entity}.[attr1], {entity}.[attr2])
VALUES ('abc', @dynamic), ('def', 'other');

-- Copy records from one entity to another
INSERT INTO {entity} ({entity}.[attr1], {entity}.[attr2])
SELECT {other}.[a], {other}.[b]
FROM {other};

-- Common table expressions
INSERT INTO {entity} ({entity}.[attr1], {entity}.[attr2])
WITH "temp1" ("id", "total") AS (
  SELECT
    {entity1}.[id] AS "id",
    SUM({entity1}.[value]) AS "total"
  FROM {entity1}
  GROUP BY {entity1}.[id]
  HAVING SUM({entity1}.[value]) > 100
), "temp2" ("id", "name") AS (
  SELECT
    {entity2}.[id] AS "id",
    {entity2}.[name] AS "name"
  FROM {entity2}
)
SELECT
  "temp2"."name",
  "temp1"."total"
FROM "temp1"
INNER JOIN "temp2"
ON "temp1"."id" = "temp2"."id"
ORDER BY "temp2"."name" ASC
LIMIT 10

-- Upsert a single record
UPSERT INTO {entity} ({entity}.[id], {entity}.[attribute])
VALUES (3, @dynamic);

-- Upsert multiple records
UPSERT INTO {entity} ({entity}.[id], {entity}.[attribute])
VALUES (3, @dynamic), (4, 'other');

-- Copy records from one entity to another, updating any existing records
UPSERT INTO {entity} ({entity}.[id], {entity}.[attribute])
SELECT {other}.[id], {other}.[value]
FROM {other};
```

## Supported operations { #supported-operations }

| Data source          | Insert (single) | Insert (multiple) | Upsert (single) | Upsert (multiple) | Insert/Upsert Select |
| -------------------- | --------------- | ----------------- | --------------- | ----------------- | -------------------- |
| Microsoft SQL Server | Yes             | Yes               | Yes             | Yes               | Yes                  |
| MySQL                | Yes             | Yes               | Yes             | Yes               | Yes                  |
| Oracle               | Yes             | Yes               | Yes             | Yes               | Yes                  |
| PostgreSQL           | Yes             | Yes               | Yes             | Yes               | Yes                  |
| Salesforce           | Yes             | Yes               | No              | No                | No                   |
| SAP OData            | Yes<sup>1</sup> | No                | No              | No                | No                   |

<sup>1</sup>: The entity must have a `POST` API. `INSERT` and `UPSERT` do not support writing to SAP OData Navigation Properties (`Record` attributes), please use the generated deep insert [server actions](../../../../integration-with-systems/external-databases/sap-odata.md) for this use case instead.

## Returned primary key attributes { ##returned-primary-key-attributes }

| Data source          | Returned primary key attributes                                    |
| :------------------- | ------------------------------------------------------------------ |
| Microsoft SQL Server | `IDENTITY` or `AS ... PERSISTED`                                   |
| MySQL                | `AUTO_INCREMENET`                                                  |
| Oracle               | `GENERATED ALWAYS AS ...`                                          |
| PostgreSQL           | `GENERATED ALWAYS AS IDENTITY` or `GENERATED ALWAYS AS ... STORED` |
| Salesforce           | Salesforce Record ID (`Id`)                                        |
| SAP OData            | OData Entity Key                                                   |
